---
title: "Project_randFor"
author: "Ayush Shetty"
date: "4/1/2022"
output: html_document
---

```{r setup, include=FALSE}
library(caret)
library(tidyverse)
library(corrplot)
library(car)
library(lmtest)
library(gmodels)
library(MLmetrics)
library(caTools)
library(glmnet)
library(tree) 
library(rpart)
library(ipred) 
library(randomForest)
library(gbm) 
library(ROCR)
```

```{r}
df = read.csv("preprocessed_model_data_ver2.csv")

df$Athletic = as.factor(df$Athletic)

df = subset(df, select = -Athletic)

head(df, 5)

sample = sample.split(df, SplitRatio = 0.8)
df_train = subset(df, sample == TRUE)
df_test  = subset(df, sample == FALSE)

```

```{r}
randFor = randomForest(avg_VO2~., data = df_train, ntree = 500) #Random forest model
randFor
```


```{r}
plot(randFor)
```

```{r}
which.min(randFor$mse) #Finding optimal number of trees required
```


```{r}
tuner = tuneRF(subset(df_train, select = -avg_VO2), df_train$avg_VO2, #Optimizing to find mtry
               stepFactor = .5,
               plot=T,
               ntreeTry = 479,
               improve = 10000)
```


```{r}
optRf = randomForest(avg_VO2~., data = df_train, mtry = 20, ntree = 479) # Optimal Random Forest model
optRf
```


```{r}
optPreds = predict(optRf, df_test)
optPredDifference = (abs(optPreds - df_test$avg_VO2)/df_test$avg_VO2)*100
mean(optPredDifference) #Percent difference in prediction

MAE(optPreds, df_test$avg_VO2) # Test Mean Absolute Error
```


```{r}
sum((df_test$avg_VO2-optPreds)^2) # Rss
```


```{r}
R2_Score(optPreds, df_test$avg_VO2) # R2 value
```


